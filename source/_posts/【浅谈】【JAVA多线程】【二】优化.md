---
title: 【浅谈】【JAVA多线程】【二】自旋锁
date: 2018-04-17 21:38:27
tags: [java,多线程,自旋锁]
---
## 锁的性能优化
JAVA在高效并发的道路上，一直挺身而进，不断优化升级，这也是为什么多数服务使用java语言的原因之一。
>自旋锁

为什么会有自旋锁呢?
我们知道，当线程遇到在竞争锁时，若未获取锁，则会被挂起。其他线程放弃锁后，又会被再次唤醒。而这一挂一醒都是需要转入内核状态中完成。

而大多数的应用，在竞争锁时，时间都会很短。为了优化这种性能，就出现了这种 **自旋锁**。顾名思义，自旋的意思是，让一个线程在竞争不到锁时，去执行一个 忙循环（可简单理解为一个```
while(true){}
```操作）。

**自旋锁**在 JDK1.4.2中就已经引入了，默认为关闭状态。```-XX:+UseSpinning
```参数来开启。在JDK1.6中，默认开启。
自旋意义在于避免了线程的状态的变更，但是，它并未放弃CPU时间。如果锁的占用时间很短，那么，这种自旋的效果就会很不错。否则，就会白白浪费CPU时间。当然，自旋也不会一直下去。通过设置```-XX:PreBlockSpin
```参数来控制自旋次数，默认为10次。


在JDK1.6中还引入了自适应的自旋锁。JVM开始变得更加聪明，它会根据上一次锁的状态，来更改这次的自旋状态。若自旋等待刚刚获取锁成功，则下一次时，JVM会认为也这次可以自旋获得。若自旋很少成功过，那么JVM也许会放弃自旋这种状态，直接将线程挂起。






## 参考
[《深入理解java虚拟机》](http://item.jd.com/11252778.html)